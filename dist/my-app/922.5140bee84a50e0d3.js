"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[922],{6922:(Rt,G,p)=>{p.r(G),p.d(G,{HomePageModule:()=>Et});var I=p(6895),K=p(6287);function X(r,e,t,n,i,s,l){try{var c=r[s](l),h=c.value}catch(d){return void t(d)}c.done?e(h):Promise.resolve(h).then(n,i)}function m(r){return function(){var e=this,t=arguments;return new Promise(function(n,i){var s=r.apply(e,t);function l(h){X(s,n,i,l,c,"next",h)}function c(h){X(s,n,i,l,c,"throw",h)}l(void 0)})}}var o=p(8256),q=p(2340);const pe=[0,2e3,1e4,3e4,null];class ee{constructor(e){this._retryDelays=void 0!==e?[...e,null]:pe}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}let z=(()=>{class r{}return r.Authorization="Authorization",r.Cookie="Cookie",r})();class te{constructor(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}}class N{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}class fe extends N{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}send(e){var t=this;return m(function*(){let n=!0;t._accessTokenFactory&&(!t._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(n=!1,t._accessToken=yield t._accessTokenFactory()),t._setAuthorizationHeader(e);const i=yield t._innerClient.send(e);return n&&401===i.statusCode&&t._accessTokenFactory?(t._accessToken=yield t._accessTokenFactory(),t._setAuthorizationHeader(e),yield t._innerClient.send(e)):i})()}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[z.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[z.Authorization]&&delete e.headers[z.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}class E extends Error{constructor(e,t){const n=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=n}}class L extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class x extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class me extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=n}}class _e extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=n}}class ve extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=n}}class Ce extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class be extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=n}}var a=(()=>{return(r=a||(a={}))[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None",a;var r})();class U{constructor(){}log(e,t){}}U.instance=new U;const ye="7.0.9";class C{static isRequired(e,t){if(null==e)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,n){if(!(e in t))throw new Error(`Unknown ${n} value: ${e}.`)}}class b{static get isBrowser(){return"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return"object"==typeof self&&"importScripts"in self}static get isReactNative(){return"object"==typeof window&&typeof window.document>"u"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}function $(r,e){let t="";return A(r)?(t=`Binary data of length ${r.byteLength}`,e&&(t+=`. Content: '${function we(r){const e=new Uint8Array(r);let t="";return e.forEach(n=>{t+=`0x${n<16?"0":""}${n.toString(16)} `}),t.substr(0,t.length-1)}(r)}'`)):"string"==typeof r&&(t=`String data of length ${r.length}`,e&&(t+=`. Content: '${r}'`)),t}function A(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function ne(r,e,t,n,i,s){return B.apply(this,arguments)}function B(){return(B=m(function*(r,e,t,n,i,s){const l={},[c,h]=R();l[c]=h,r.log(a.Trace,`(${e} transport) sending data. ${$(i,s.logMessageContent)}.`);const d=A(i)?"arraybuffer":"text",g=yield t.post(n,{content:i,headers:{...l,...s.headers},responseType:d,timeout:s.timeout,withCredentials:s.withCredentials});r.log(a.Trace,`(${e} transport) request complete. Response status: ${g.statusCode}.`)})).apply(this,arguments)}class xe{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class H{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const n=`[${(new Date).toISOString()}] ${a[e]}: ${t}`;switch(e){case a.Critical:case a.Error:this.out.error(n);break;case a.Warning:this.out.warn(n);break;case a.Information:this.out.info(n);break;default:this.out.log(n)}}}}function R(){let r="X-SignalR-User-Agent";return b.isNode&&(r="User-Agent"),[r,Te(ye,Ie(),b.isNode?"NodeJS":"Browser",ke())]}function Te(r,e,t,n){let i="Microsoft SignalR/";const s=r.split(".");return i+=`${s[0]}.${s[1]}`,i+=` (${r}; `,i+=e&&""!==e?`${e}; `:"Unknown OS; ",i+=`${t}`,i+=n?`; ${n}`:"; Unknown Runtime Version",i+=")",i}function Ie(){if(!b.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function ke(){if(b.isNode)return process.versions.node}function oe(r){return r.stack?r.stack:r.message?r.message:`${r}`}class Pe extends N{constructor(e){if(super(),this._logger=e,typeof fetch>"u"){const t=require;this._jar=new(t("tough-cookie").CookieJar),this._fetchType=t("node-fetch"),this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function Re(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}());if(typeof AbortController>"u"){const t=require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}send(e){var t=this;return m(function*(){if(e.abortSignal&&e.abortSignal.aborted)throw new x;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const n=new t._abortControllerType;let i;e.abortSignal&&(e.abortSignal.onabort=()=>{n.abort(),i=new x});let l,s=null;e.timeout&&(s=setTimeout(()=>{n.abort(),t._logger.log(a.Warning,"Timeout from HTTP request."),i=new L},e.timeout)),""===e.content&&(e.content=void 0),e.content&&(e.headers=e.headers||{},e.headers["Content-Type"]=A(e.content)?"application/octet-stream":"text/plain;charset=UTF-8");try{l=yield t._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:n.signal})}catch(d){throw i||(t._logger.log(a.Warning,`Error from HTTP request. ${d}.`),d)}finally{s&&clearTimeout(s),e.abortSignal&&(e.abortSignal.onabort=null)}if(!l.ok){const d=yield re(l,"text");throw new E(d||l.statusText,l.status)}const h=yield re(l,e.responseType);return new te(l.status,l.statusText,h)})()}getCookieString(e){let t="";return b.isNode&&this._jar&&this._jar.getCookies(e,(n,i)=>t=i.join("; ")),t}}function re(r,e){let t;switch(e){case"arraybuffer":t=r.arrayBuffer();break;case"text":default:t=r.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return t}class De extends N{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new x):e.method?e.url?new Promise((t,n)=>{const i=new XMLHttpRequest;i.open(e.method,e.url,!0),i.withCredentials=void 0===e.withCredentials||e.withCredentials,i.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===e.content&&(e.content=void 0),e.content&&(A(e.content)?i.setRequestHeader("Content-Type","application/octet-stream"):i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const s=e.headers;s&&Object.keys(s).forEach(l=>{i.setRequestHeader(l,s[l])}),e.responseType&&(i.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{i.abort(),n(new x)}),e.timeout&&(i.timeout=e.timeout),i.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),i.status>=200&&i.status<300?t(new te(i.status,i.statusText,i.response||i.responseText)):n(new E(i.response||i.responseText||i.statusText,i.status))},i.onerror=()=>{this._logger.log(a.Warning,`Error from HTTP request. ${i.status}: ${i.statusText}.`),n(new E(i.statusText,i.status))},i.ontimeout=()=>{this._logger.log(a.Warning,"Timeout from HTTP request."),n(new L)},i.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class ze extends N{constructor(e){if(super(),typeof fetch<"u"||b.isNode)this._httpClient=new Pe(e);else{if(!(typeof XMLHttpRequest<"u"))throw new Error("No usable HttpClient found.");this._httpClient=new De(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new x):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}var v=(()=>{return(r=v||(v={}))[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling",v;var r})(),w=(()=>{return(r=w||(w={}))[r.Text=1]="Text",r[r.Binary=2]="Binary",w;var r})();class Ue{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class ie{constructor(e,t,n){this._httpClient=e,this._logger=t,this._pollAbort=new Ue,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}connect(e,t){var n=this;return m(function*(){if(C.isRequired(e,"url"),C.isRequired(t,"transferFormat"),C.isIn(t,w,"transferFormat"),n._url=e,n._logger.log(a.Trace,"(LongPolling transport) Connecting."),t===w.Binary&&typeof XMLHttpRequest<"u"&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[i,s]=R(),l={[i]:s,...n._options.headers},c={abortSignal:n._pollAbort.signal,headers:l,timeout:1e5,withCredentials:n._options.withCredentials};t===w.Binary&&(c.responseType="arraybuffer");const h=`${e}&_=${Date.now()}`;n._logger.log(a.Trace,`(LongPolling transport) polling: ${h}.`);const d=yield n._httpClient.get(h,c);200!==d.statusCode?(n._logger.log(a.Error,`(LongPolling transport) Unexpected response code: ${d.statusCode}.`),n._closeError=new E(d.statusText||"",d.statusCode),n._running=!1):n._running=!0,n._receiving=n._poll(n._url,c)})()}_poll(e,t){var n=this;return m(function*(){try{for(;n._running;)try{const i=`${e}&_=${Date.now()}`;n._logger.log(a.Trace,`(LongPolling transport) polling: ${i}.`);const s=yield n._httpClient.get(i,t);204===s.statusCode?(n._logger.log(a.Information,"(LongPolling transport) Poll terminated by server."),n._running=!1):200!==s.statusCode?(n._logger.log(a.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),n._closeError=new E(s.statusText||"",s.statusCode),n._running=!1):s.content?(n._logger.log(a.Trace,`(LongPolling transport) data received. ${$(s.content,n._options.logMessageContent)}.`),n.onreceive&&n.onreceive(s.content)):n._logger.log(a.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(i){n._running?i instanceof L?n._logger.log(a.Trace,"(LongPolling transport) Poll timed out, reissuing."):(n._closeError=i,n._running=!1):n._logger.log(a.Trace,`(LongPolling transport) Poll errored after shutdown: ${i.message}`)}}finally{n._logger.log(a.Trace,"(LongPolling transport) Polling complete."),n.pollAborted||n._raiseOnClose()}})()}send(e){var t=this;return m(function*(){return t._running?ne(t._logger,"LongPolling",t._httpClient,t._url,e,t._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){var e=this;return m(function*(){e._logger.log(a.Trace,"(LongPolling transport) Stopping polling."),e._running=!1,e._pollAbort.abort();try{yield e._receiving,e._logger.log(a.Trace,`(LongPolling transport) sending DELETE request to ${e._url}.`);const t={},[n,i]=R();t[n]=i;const s={headers:{...t,...e._options.headers},timeout:e._options.timeout,withCredentials:e._options.withCredentials};yield e._httpClient.delete(e._url,s),e._logger.log(a.Trace,"(LongPolling transport) DELETE request sent.")}finally{e._logger.log(a.Trace,"(LongPolling transport) Stop finished."),e._raiseOnClose()}})()}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(a.Trace,e),this.onclose(this._closeError)}}}class $e{constructor(e,t,n,i){this._httpClient=e,this._accessToken=t,this._logger=n,this._options=i,this.onreceive=null,this.onclose=null}connect(e,t){var n=this;return m(function*(){return C.isRequired(e,"url"),C.isRequired(t,"transferFormat"),C.isIn(t,w,"transferFormat"),n._logger.log(a.Trace,"(SSE transport) Connecting."),n._url=e,n._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n._accessToken)}`),new Promise((i,s)=>{let c,l=!1;if(t===w.Text){if(b.isBrowser||b.isWebWorker)c=new n._options.EventSource(e,{withCredentials:n._options.withCredentials});else{const h=n._httpClient.getCookieString(e),d={};d.Cookie=h;const[g,f]=R();d[g]=f,c=new n._options.EventSource(e,{withCredentials:n._options.withCredentials,headers:{...d,...n._options.headers}})}try{c.onmessage=h=>{if(n.onreceive)try{n._logger.log(a.Trace,`(SSE transport) data received. ${$(h.data,n._options.logMessageContent)}.`),n.onreceive(h.data)}catch(d){return void n._close(d)}},c.onerror=h=>{l?n._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},c.onopen=()=>{n._logger.log(a.Information,`SSE connected to ${n._url}`),n._eventSource=c,l=!0,i()}}catch(h){return void s(h)}}else s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})})()}send(e){var t=this;return m(function*(){return t._eventSource?ne(t._logger,"SSE",t._httpClient,t._url,e,t._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class Ae{constructor(e,t,n,i,s,l){this._logger=n,this._accessTokenFactory=t,this._logMessageContent=i,this._webSocketConstructor=s,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=l}connect(e,t){var n=this;return m(function*(){let i;return C.isRequired(e,"url"),C.isRequired(t,"transferFormat"),C.isIn(t,w,"transferFormat"),n._logger.log(a.Trace,"(WebSockets transport) Connecting."),n._accessTokenFactory&&(i=yield n._accessTokenFactory()),new Promise((s,l)=>{let c;e=e.replace(/^http/,"ws");const h=n._httpClient.getCookieString(e);let d=!1;if(b.isNode||b.isReactNative){const g={},[f,D]=R();g[f]=D,i&&(g[z.Authorization]=`Bearer ${i}`),h&&(g[z.Cookie]=h),c=new n._webSocketConstructor(e,void 0,{headers:{...g,...n._headers}})}else i&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(i)}`);c||(c=new n._webSocketConstructor(e)),t===w.Binary&&(c.binaryType="arraybuffer"),c.onopen=g=>{n._logger.log(a.Information,`WebSocket connected to ${e}.`),n._webSocket=c,d=!0,s()},c.onerror=g=>{let f=null;f=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"There was an error with the transport",n._logger.log(a.Information,`(WebSockets transport) ${f}.`)},c.onmessage=g=>{if(n._logger.log(a.Trace,`(WebSockets transport) data received. ${$(g.data,n._logMessageContent)}.`),n.onreceive)try{n.onreceive(g.data)}catch(f){return void n._close(f)}},c.onclose=g=>{if(d)n._close(g);else{let f=null;f=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",l(new Error(f))}}})})()}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(a.Trace,`(WebSockets transport) sending data. ${$(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(a.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||!1!==e.wasClean&&1e3===e.code?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&"boolean"==typeof e.wasClean&&"number"==typeof e.code}}class Ne{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,C.isRequired(e,"url"),this._logger=function Se(r){return void 0===r?new H(a.Information):null===r?U.instance:void 0!==r.log?r:new H(r)}(t.logger),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=void 0!==t.logMessageContent&&t.logMessageContent,"boolean"!=typeof t.withCredentials&&void 0!==t.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=void 0===t.withCredentials||t.withCredentials,t.timeout=void 0===t.timeout?1e5:t.timeout;let n=null,i=null;if(b.isNode){const s=require;n=s("ws"),i=s("eventsource")}!b.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:b.isNode&&!t.WebSocket&&n&&(t.WebSocket=n),!b.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:b.isNode&&!t.EventSource&&typeof i<"u"&&(t.EventSource=i),this._httpClient=new fe(t.httpClient||new ze(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}start(e){var t=this;return m(function*(){if(C.isIn(e=e||w.Binary,w,"transferFormat"),t._logger.log(a.Debug,`Starting connection with transfer format '${w[e]}'.`),"Disconnected"!==t._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(t._connectionState="Connecting",t._startInternalPromise=t._startInternal(e),yield t._startInternalPromise,"Disconnecting"===t._connectionState){const n="Failed to start the HttpConnection before stop() was called.";return t._logger.log(a.Error,n),yield t._stopPromise,Promise.reject(new x(n))}if("Connected"!==t._connectionState){const n="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return t._logger.log(a.Error,n),Promise.reject(new x(n))}t._connectionStarted=!0})()}send(e){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new W(this.transport)),this._sendQueue.send(e))}stop(e){var t=this;return m(function*(){return"Disconnected"===t._connectionState?(t._logger.log(a.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===t._connectionState?(t._logger.log(a.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),t._stopPromise):(t._connectionState="Disconnecting",t._stopPromise=new Promise(n=>{t._stopPromiseResolver=n}),yield t._stopInternal(e),void(yield t._stopPromise))})()}_stopInternal(e){var t=this;return m(function*(){t._stopError=e;try{yield t._startInternalPromise}catch{}if(t.transport){try{yield t.transport.stop()}catch(n){t._logger.log(a.Error,`HttpConnection.transport.stop() threw error '${n}'.`),t._stopConnection()}t.transport=void 0}else t._logger.log(a.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})()}_startInternal(e){var t=this;return m(function*(){let n=t.baseUrl;t._accessTokenFactory=t._options.accessTokenFactory,t._httpClient._accessTokenFactory=t._accessTokenFactory;try{if(t._options.skipNegotiation){if(t._options.transport!==v.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");t.transport=t._constructTransport(v.WebSockets),yield t._startTransport(n,e)}else{let i=null,s=0;do{if(i=yield t._getNegotiationResponse(n),"Disconnecting"===t._connectionState||"Disconnected"===t._connectionState)throw new x("The connection was stopped during negotiation.");if(i.error)throw new Error(i.error);if(i.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(i.url&&(n=i.url),i.accessToken){const l=i.accessToken;t._accessTokenFactory=()=>l,t._httpClient._accessToken=l,t._httpClient._accessTokenFactory=void 0}s++}while(i.url&&s<100);if(100===s&&i.url)throw new Error("Negotiate redirection limit exceeded.");yield t._createTransport(n,t._options.transport,i,e)}t.transport instanceof ie&&(t.features.inherentKeepAlive=!0),"Connecting"===t._connectionState&&(t._logger.log(a.Debug,"The HttpConnection connected successfully."),t._connectionState="Connected")}catch(i){return t._logger.log(a.Error,"Failed to start the connection: "+i),t._connectionState="Disconnected",t.transport=void 0,t._stopPromiseResolver(),Promise.reject(i)}})()}_getNegotiationResponse(e){var t=this;return m(function*(){const n={},[i,s]=R();n[i]=s;const l=t._resolveNegotiateUrl(e);t._logger.log(a.Debug,`Sending negotiation request: ${l}.`);try{const c=yield t._httpClient.post(l,{content:"",headers:{...n,...t._options.headers},timeout:t._options.timeout,withCredentials:t._options.withCredentials});if(200!==c.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${c.statusCode}'`));const h=JSON.parse(c.content);return(!h.negotiateVersion||h.negotiateVersion<1)&&(h.connectionToken=h.connectionId),h}catch(c){let h="Failed to complete negotiation with the server: "+c;return c instanceof E&&404===c.statusCode&&(h+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),t._logger.log(a.Error,h),Promise.reject(new Ce(h))}})()}_createConnectUrl(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+`id=${t}`:e}_createTransport(e,t,n,i){var s=this;return m(function*(){let l=s._createConnectUrl(e,n.connectionToken);if(s._isITransport(t))return s._logger.log(a.Debug,"Connection was provided an instance of ITransport, using that directly."),s.transport=t,yield s._startTransport(l,i),void(s.connectionId=n.connectionId);const c=[],h=n.availableTransports||[];let d=n;for(const g of h){const f=s._resolveTransportOrError(g,t,i);if(f instanceof Error)c.push(`${g.transport} failed:`),c.push(f);else if(s._isITransport(f)){if(s.transport=f,!d){try{d=yield s._getNegotiationResponse(e)}catch(D){return Promise.reject(D)}l=s._createConnectUrl(e,d.connectionToken)}try{return yield s._startTransport(l,i),void(s.connectionId=d.connectionId)}catch(D){if(s._logger.log(a.Error,`Failed to start the transport '${g.transport}': ${D}`),d=void 0,c.push(new ve(`${g.transport} failed: ${D}`,v[g.transport])),"Connecting"!==s._connectionState){const ue="Failed to select transport before stop() was called.";return s._logger.log(a.Debug,ue),Promise.reject(new x(ue))}}}}return Promise.reject(c.length>0?new be(`Unable to connect to the server with any of the available transports. ${c.join(" ")}`,c):new Error("None of the transports supported by the client are supported by the server."))})()}_constructTransport(e){switch(e){case v.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ae(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case v.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new $e(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case v.LongPolling:return new ie(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.transport.onclose=n=>this._stopConnection(n),this.transport.connect(e,t)}_resolveTransportOrError(e,t,n){const i=v[e.transport];if(null==i)return this._logger.log(a.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function He(r,e){return!r||0!=(e&r)}(t,i))return this._logger.log(a.Debug,`Skipping transport '${v[i]}' because it was disabled by the client.`),new _e(`'${v[i]}' is disabled by the client.`,i);if(!(e.transferFormats.map(l=>w[l]).indexOf(n)>=0))return this._logger.log(a.Debug,`Skipping transport '${v[i]}' because it does not support the requested transfer format '${w[n]}'.`),new Error(`'${v[i]}' does not support ${w[n]}.`);if(i===v.WebSockets&&!this._options.WebSocket||i===v.ServerSentEvents&&!this._options.EventSource)return this._logger.log(a.Debug,`Skipping transport '${v[i]}' because it is not supported in your environment.'`),new me(`'${v[i]}' is not supported in your environment.`,i);this._logger.log(a.Debug,`Selecting transport '${v[i]}'.`);try{return this._constructTransport(i)}catch(l){return l}}_isITransport(e){return e&&"object"==typeof e&&"connect"in e}_stopConnection(e){if(this._logger.log(a.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(a.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),e?this._logger.log(a.Error,`Connection disconnected with error '${e}'.`):this._logger.log(a.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(a.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(a.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(a.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if(!b.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(a.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=e.indexOf("?");let n=e.substring(0,-1===t?e.length:t);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",n+=-1===t?"":e.substring(t),-1===n.indexOf("negotiateVersion")&&(n+=-1===t?"?":"&",n+="negotiateVersion="+this._negotiateVersion),n}}class W{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new M,this._transportResult=new M,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new M),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}_sendLoop(){var e=this;return m(function*(){for(;;){if(yield e._sendBufferedData.promise,!e._executing){e._transportResult&&e._transportResult.reject("Connection stopped.");break}e._sendBufferedData=new M;const t=e._transportResult;e._transportResult=void 0;const n="string"==typeof e._buffer[0]?e._buffer.join(""):W._concatBuffers(e._buffer);e._buffer.length=0;try{yield e._transport.send(n),t.resolve()}catch(i){t.reject(i)}}})()}static _concatBuffers(e){const t=e.map(s=>s.byteLength).reduce((s,l)=>s+l),n=new Uint8Array(t);let i=0;for(const s of e)n.set(new Uint8Array(s),i),i+=s.byteLength;return n.buffer}}class M{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class S{static write(e){return`${e}${S.RecordSeparator}`}static parse(e){if(e[e.length-1]!==S.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(S.RecordSeparator);return t.pop(),t}}S.RecordSeparatorCode=30,S.RecordSeparator=String.fromCharCode(S.RecordSeparatorCode);class Me{writeHandshakeRequest(e){return S.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,n;if(A(e)){const c=new Uint8Array(e),h=c.indexOf(S.RecordSeparatorCode);if(-1===h)throw new Error("Message is incomplete.");const d=h+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(c.slice(0,d))),n=c.byteLength>d?c.slice(d).buffer:null}else{const c=e,h=c.indexOf(S.RecordSeparator);if(-1===h)throw new Error("Message is incomplete.");const d=h+1;t=c.substring(0,d),n=c.length>d?c.substring(d):null}const i=S.parse(t),s=JSON.parse(i[0]);if(s.type)throw new Error("Expected a handshake response from the server.");return[n,s]}}var u=(()=>{return(r=u||(u={}))[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close",u;var r})();class Oe{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new xe(this,e)}}var _=(()=>{return(r=_||(_={})).Disconnected="Disconnected",r.Connecting="Connecting",r.Connected="Connected",r.Disconnecting="Disconnecting",r.Reconnecting="Reconnecting",_;var r})();class J{constructor(e,t,n,i){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(a.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},C.isRequired(e,"connection"),C.isRequired(t,"logger"),C.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this._logger=t,this._protocol=n,this.connection=e,this._reconnectPolicy=i,this._handshakeProtocol=new Me,this.connection.onreceive=s=>this._processIncomingData(s),this.connection.onclose=s=>this._connectionClosed(s),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=_.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:u.Ping})}static create(e,t,n,i){return new J(e,t,n,i)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==_.Disconnected&&this._connectionState!==_.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){var e=this;return m(function*(){if(e._connectionState!==_.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));e._connectionState=_.Connecting,e._logger.log(a.Debug,"Starting HubConnection.");try{yield e._startInternal(),b.isBrowser&&window.document.addEventListener("freeze",e._freezeEventListener),e._connectionState=_.Connected,e._connectionStarted=!0,e._logger.log(a.Debug,"HubConnection connected successfully.")}catch(t){return e._connectionState=_.Disconnected,e._logger.log(a.Debug,`HubConnection failed to start successfully because of error '${t}'.`),Promise.reject(t)}})()}_startInternal(){var e=this;return m(function*(){e._stopDuringStartError=void 0,e._receivedHandshakeResponse=!1;const t=new Promise((n,i)=>{e._handshakeResolver=n,e._handshakeRejecter=i});yield e.connection.start(e._protocol.transferFormat);try{const n={protocol:e._protocol.name,version:e._protocol.version};if(e._logger.log(a.Debug,"Sending handshake request."),yield e._sendMessage(e._handshakeProtocol.writeHandshakeRequest(n)),e._logger.log(a.Information,`Using HubProtocol '${e._protocol.name}'.`),e._cleanupTimeout(),e._resetTimeoutPeriod(),e._resetKeepAliveInterval(),yield t,e._stopDuringStartError)throw e._stopDuringStartError;e.connection.features.inherentKeepAlive||(yield e._sendMessage(e._cachedPingMessage))}catch(n){throw e._logger.log(a.Debug,`Hub handshake failed with error '${n}' during start(). Stopping HubConnection.`),e._cleanupTimeout(),e._cleanupPingTimer(),yield e.connection.stop(n),n}})()}stop(){var e=this;return m(function*(){const t=e._startPromise;e._stopPromise=e._stopInternal(),yield e._stopPromise;try{yield t}catch{}})()}_stopInternal(e){return this._connectionState===_.Disconnected?(this._logger.log(a.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===_.Disconnecting?(this._logger.log(a.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=_.Disconnecting,this._logger.log(a.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(a.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new x("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))}stream(e,...t){const[n,i]=this._replaceStreamingParams(t),s=this._createStreamInvocation(e,t,i);let l;const c=new Oe;return c.cancelCallback=()=>{const h=this._createCancelInvocation(s.invocationId);return delete this._callbacks[s.invocationId],l.then(()=>this._sendWithProtocol(h))},this._callbacks[s.invocationId]=(h,d)=>{d?c.error(d):h&&(h.type===u.Completion?h.error?c.error(new Error(h.error)):c.complete():c.next(h.item))},l=this._sendWithProtocol(s).catch(h=>{c.error(h),delete this._callbacks[s.invocationId]}),this._launchStreams(n,l),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[n,i]=this._replaceStreamingParams(t),s=this._sendWithProtocol(this._createInvocation(e,t,!0,i));return this._launchStreams(n,s),s}invoke(e,...t){const[n,i]=this._replaceStreamingParams(t),s=this._createInvocation(e,t,!1,i);return new Promise((c,h)=>{this._callbacks[s.invocationId]=(g,f)=>{f?h(f):g&&(g.type===u.Completion?g.error?h(new Error(g.error)):c(g.result):h(new Error(`Unexpected message type: ${g.type}`)))};const d=this._sendWithProtocol(s).catch(g=>{h(g),delete this._callbacks[s.invocationId]});this._launchStreams(n,d)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),-1===this._methods[e].indexOf(t)&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const n=this._methods[e];if(n)if(t){const i=n.indexOf(t);-1!==i&&(n.splice(i,1),0===n.length&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const n of t)switch(n.type){case u.Invocation:this._invokeClientMethod(n);break;case u.StreamItem:case u.Completion:{const i=this._callbacks[n.invocationId];if(i){n.type===u.Completion&&delete this._callbacks[n.invocationId];try{i(n)}catch(s){this._logger.log(a.Error,`Stream callback threw error: ${oe(s)}`)}}break}case u.Ping:break;case u.Close:{this._logger.log(a.Information,"Close message received from server.");const i=n.error?new Error("Server returned an error on close: "+n.error):void 0;!0===n.allowReconnect?this.connection.stop(i):this._stopPromise=this._stopInternal(i);break}default:this._logger.log(a.Warning,`Invalid message type: ${n.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,n;try{[n,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(i){const s="Error parsing handshake response: "+i;this._logger.log(a.Error,s);const l=new Error(s);throw this._handshakeRejecter(l),l}if(t.error){const i="Server returned handshake error: "+t.error;this._logger.log(a.Error,i);const s=new Error(i);throw this._handshakeRejecter(s),s}return this._logger.log(a.Debug,"Server handshake complete."),this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){var e=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let t=this._nextKeepAlive-(new Date).getTime();t<0&&(t=0),this._pingServerHandle=setTimeout(m(function*(){if(e._connectionState===_.Connected)try{yield e._sendMessage(e._cachedPingMessage)}catch{e._cleanupPingTimer()}}),t)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(e){var t=this;return m(function*(){const n=e.target.toLowerCase(),i=t._methods[n];if(!i)return t._logger.log(a.Warning,`No client method with the name '${n}' found.`),void(e.invocationId&&(t._logger.log(a.Warning,`No result given for '${n}' method and invocation ID '${e.invocationId}'.`),yield t._sendWithProtocol(t._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const s=i.slice(),l=!!e.invocationId;let c,h,d;for(const g of s)try{const f=c;c=yield g.apply(t,e.arguments),l&&c&&f&&(t._logger.log(a.Error,`Multiple results provided for '${n}'. Sending error to server.`),d=t._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),h=void 0}catch(f){h=f,t._logger.log(a.Error,`A callback for the method '${n}' threw error '${f}'.`)}d?yield t._sendWithProtocol(d):l?(h?d=t._createCompletionMessage(e.invocationId,`${h}`,null):void 0!==c?d=t._createCompletionMessage(e.invocationId,null,c):(t._logger.log(a.Warning,`No result given for '${n}' method and invocation ID '${e.invocationId}'.`),d=t._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),yield t._sendWithProtocol(d)):c&&t._logger.log(a.Error,`Result given for '${n}' method but server is not expecting a result.`)})()}_connectionClosed(e){this._logger.log(a.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new x("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===_.Disconnecting?this._completeClose(e):this._connectionState===_.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===_.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=_.Disconnected,this._connectionStarted=!1,b.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(a.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}_reconnect(e){var t=this;return m(function*(){const n=Date.now();let i=0,s=void 0!==e?e:new Error("Attempting to reconnect due to a unknown error."),l=t._getNextRetryDelay(i++,0,s);if(null===l)return t._logger.log(a.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void t._completeClose(e);if(t._connectionState=_.Reconnecting,t._logger.log(a.Information,e?`Connection reconnecting because of error '${e}'.`:"Connection reconnecting."),0!==t._reconnectingCallbacks.length){try{t._reconnectingCallbacks.forEach(c=>c.apply(t,[e]))}catch(c){t._logger.log(a.Error,`An onreconnecting callback called with error '${e}' threw error '${c}'.`)}if(t._connectionState!==_.Reconnecting)return void t._logger.log(a.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==l;){if(t._logger.log(a.Information,`Reconnect attempt number ${i} will start in ${l} ms.`),yield new Promise(c=>{t._reconnectDelayHandle=setTimeout(c,l)}),t._reconnectDelayHandle=void 0,t._connectionState!==_.Reconnecting)return void t._logger.log(a.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(yield t._startInternal(),t._connectionState=_.Connected,t._logger.log(a.Information,"HubConnection reconnected successfully."),0!==t._reconnectedCallbacks.length)try{t._reconnectedCallbacks.forEach(c=>c.apply(t,[t.connection.connectionId]))}catch(c){t._logger.log(a.Error,`An onreconnected callback called with connectionId '${t.connection.connectionId}; threw error '${c}'.`)}return}catch(c){if(t._logger.log(a.Information,`Reconnect attempt failed because of error '${c}'.`),t._connectionState!==_.Reconnecting)return t._logger.log(a.Debug,`Connection moved to the '${t._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(t._connectionState===_.Disconnecting&&t._completeClose());s=c instanceof Error?c:new Error(c.toString()),l=t._getNextRetryDelay(i++,Date.now()-n,s)}}t._logger.log(a.Information,`Reconnect retries have been exhausted after ${Date.now()-n} ms and ${i} failed attempts. Connection disconnecting.`),t._completeClose()})()}_getNextRetryDelay(e,t,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(i){return this._logger.log(a.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${i}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(n=>{const i=t[n];try{i(null,e)}catch(s){this._logger.log(a.Error,`Stream 'error' callback called with '${e}' threw error: ${oe(s)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,n,i){if(n)return 0!==i.length?{arguments:t,streamIds:i,target:e,type:u.Invocation}:{arguments:t,target:e,type:u.Invocation};{const s=this._invocationId;return this._invocationId++,0!==i.length?{arguments:t,invocationId:s.toString(),streamIds:i,target:e,type:u.Invocation}:{arguments:t,invocationId:s.toString(),target:e,type:u.Invocation}}}_launchStreams(e,t){if(0!==e.length){t||(t=Promise.resolve());for(const n in e)e[n].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:i=>{let s;s=i instanceof Error?i.message:i&&i.toString?i.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,s)))},next:i=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,i)))}})}}_replaceStreamingParams(e){const t=[],n=[];for(let i=0;i<e.length;i++){const s=e[i];if(this._isObservable(s)){const l=this._invocationId;this._invocationId++,t[l]=s,n.push(l.toString()),e.splice(i,1)}}return[t,n]}_isObservable(e){return e&&e.subscribe&&"function"==typeof e.subscribe}_createStreamInvocation(e,t,n){const i=this._invocationId;return this._invocationId++,0!==n.length?{arguments:t,invocationId:i.toString(),streamIds:n,target:e,type:u.StreamInvocation}:{arguments:t,invocationId:i.toString(),target:e,type:u.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:u.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:u.StreamItem}}_createCompletionMessage(e,t,n){return t?{error:t,invocationId:e,type:u.Completion}:{invocationId:e,result:n,type:u.Completion}}}class Be{constructor(){this.name="json",this.version=1,this.transferFormat=w.Text}parseMessages(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=U.instance);const n=S.parse(e),i=[];for(const s of n){const l=JSON.parse(s);if("number"!=typeof l.type)throw new Error("Invalid payload.");switch(l.type){case u.Invocation:this._isInvocationMessage(l);break;case u.StreamItem:this._isStreamItemMessage(l);break;case u.Completion:this._isCompletionMessage(l);break;case u.Ping:case u.Close:break;default:t.log(a.Information,"Unknown message type '"+l.type+"' ignored.");continue}i.push(l)}return i}writeMessage(e){return S.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(e,t){if("string"!=typeof e||""===e)throw new Error(t)}}const We={trace:a.Trace,debug:a.Debug,info:a.Information,information:a.Information,warn:a.Warning,warning:a.Warning,error:a.Error,critical:a.Critical,none:a.None};class ae{configureLogging(e){if(C.isRequired(e,"logging"),function je(r){return void 0!==r.log}(e))this.logger=e;else if("string"==typeof e){const t=function Je(r){const e=We[r.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${r}`)}(e);this.logger=new H(t)}else this.logger=new H(e);return this}withUrl(e,t){return C.isRequired(e,"url"),C.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions="object"==typeof t?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return C.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=e?Array.isArray(e)?new ee(e):e:new ee,this}build(){const e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new Ne(this.url,e);return J.create(t,this.logger||U.instance,this.protocol||new Be,this.reconnectPolicy)}}var j=p(6551);let O=(()=>{class r extends j.b{constructor(){super(...arguments),this.middlePath="/Room",this.endPoint=this.middlePath}getListRooom(){return this.GetbyExt("/myroom")}createRoom(t){return this.PostbyExt("",t)}getRoomInfor(t){return this.GetbyExt("/"+t)}}return r.\u0275fac=function(){let e;return function(n){return(e||(e=o.n5z(r)))(n||r)}}(),r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),Ve=(()=>{class r extends j.b{constructor(){super(...arguments),this.middlePath="/User",this.endPoint=this.middlePath}getListUser(){return this.GetAll()}getListUserByIdRoom(t){return this.GetbyExt("/getListUser?roomId="+t)}getUserInfor(){return this.GetbyExt("/infor")}}return r.\u0275fac=function(){let e;return function(n){return(e||(e=o.n5z(r)))(n||r)}}(),r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var ce=p(263),le=p(8196),Z=p(6231),V=p(8032),Q=p(6721),T=p(697),y=p(433),F=p(1778),k=p(2160),Y=p(6571),P=p(2216);function Qe(r,e){if(1&r&&(o.TgZ(0,"nz-option",10),o._UZ(1,"nz-avatar",11),o._uU(2),o.qZA()),2&r){const t=e.$implicit;o.Q6J("nzLabel",t.userName)("nzValue",t),o.xp6(1),o.Q6J("nzSrc",t.image),o.xp6(1),o.hij(" ",t.userName," ")}}function Ye(r,e){if(1&r){const t=o.EpF();o.ynx(0),o.TgZ(1,"form",3),o.NdJ("ngSubmit",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.submitForm())}),o.TgZ(2,"nz-form-item")(3,"nz-form-control",4)(4,"nz-input-group",5),o._UZ(5,"input",6),o.qZA()()(),o.TgZ(6,"nz-form-item")(7,"nz-form-control",4)(8,"nz-input-group",5)(9,"nz-select",7),o.YNc(10,Qe,3,4,"nz-option",8),o.qZA()()()(),o.TgZ(11,"nz-form-item")(12,"nz-form-control")(13,"button",9),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.createRoom())}),o._uU(14,"Create"),o.qZA()()()(),o.BQk()}if(2&r){const t=o.oxw();o.xp6(1),o.Q6J("nzLayout","inline")("formGroup",t.validateForm),o.xp6(9),o.Q6J("ngForOf",t.list),o.xp6(3),o.Q6J("disabled",!t.validateForm.valid)}}let Ge=(()=>{class r{submitForm(){for(const t in this.validateForm.controls)this.validateForm.controls[t].markAsDirty(),this.validateForm.controls[t].updateValueAndValidity()}constructor(t,n){this.fb=t,this.roomService=n,this.taoThanhCong=new o.vpe,this.isVisible=!1}ngOnInit(){this.validateForm=this.fb.group({roomName:[null,[y.kI.required]],listUser:[null,[y.kI.required]]})}showModal(){this.isVisible=!0}handleOk(){console.log("Button ok clicked!"),this.isVisible=!1}handleCancel(){console.log("Button cancel clicked!"),this.isVisible=!1}createRoom(){let t={roomName:this.validateForm.controls.roomName.value,listUser:this.validateForm.controls.listUser.value.map(n=>n.userName),listIdUser:this.validateForm.controls.listUser.value.map(n=>n.id)};console.log(t),this.validateForm.valid&&this.roomService.createRoom(t).subscribe(n=>{console.log(n),this.taoThanhCong.emit()})}}return r.\u0275fac=function(t){return new(t||r)(o.Y36(y.qu),o.Y36(O))},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-create-room"]],inputs:{list:"list"},outputs:{taoThanhCong:"taoThanhCong"},decls:5,vars:1,consts:[["nz-button","","nzType","primary","nzShape","round",3,"click"],["nzTitle","The first Modal",3,"nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[4,"nzModalContent"],["nz-form","",3,"nzLayout","formGroup","ngSubmit"],["nzErrorTip","Please input your Room"],["nzPrefixIcon","user"],["formControlName","roomName","nz-input","","placeholder","Name Room"],["nzMode","multiple","nzPlaceHolder","Inserted are removed","formControlName","listUser",2,"width","200px"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-button","","nzType","primary",3,"disabled","click"],["nzCustomContent","",3,"nzLabel","nzValue"],[3,"nzSrc"]],template:function(t,n){1&t&&(o.TgZ(0,"div")(1,"button",0),o.NdJ("click",function(){return n.showModal()}),o._uU(2,"Create Room"),o.qZA()(),o.TgZ(3,"nz-modal",1),o.NdJ("nzVisibleChange",function(s){return n.isVisible=s})("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),o.YNc(4,Ye,15,4,"ng-container",2),o.qZA()),2&t&&(o.xp6(3),o.Q6J("nzVisible",n.isVisible))},dependencies:[I.sg,y._Y,y.Fj,y.JJ,y.JL,y.sg,y.u,Z.ix,V.w,Q.dQ,T.t3,T.SK,F.du,F.Hf,k.Lr,k.Nx,k.Fd,Y.Ip,Y.Vq,P.Dz]}),r})(),Ke=(()=>{class r extends j.b{constructor(){super(...arguments),this.middlePath="/Chat",this.endPoint=this.middlePath}getListChatByIdRoom(t,n=1){return this.GetbyExt("/"+t+"?page="+n)}sendMessage(t){return this.PostbyExt("",t)}sendMessageImage(t){return this.PostFilebyExt("",t)}}return r.\u0275fac=function(){let e;return function(n){return(e||(e=o.n5z(r)))(n||r)}}(),r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var he=p(8765),de=p(9760),ge=p(6919);const Xe=["content1"];function qe(r,e){if(1&r&&o._UZ(0,"nz-avatar",35),2&r){const t=e.$implicit,n=o.oxw(3);o.Q6J("nzSrc",n.getAvatar(t)?n.getAvatar(t):"https://bootdey.com/img/Content/avatar/avatar1.png")}}function et(r,e){if(1&r&&(o.TgZ(0,"nz-avatar-group"),o.YNc(1,qe,1,1,"nz-avatar",34),o.qZA()),2&r){const t=o.oxw(2);o.xp6(1),o.Q6J("ngForOf",t.roomDetail.listIdUser)}}function tt(r,e){if(1&r&&o._UZ(0,"img",36),2&r){const t=o.oxw(2);o.Q6J("src",t.getAvatar(t.roomDetail.listIdUser[0])?t.getAvatar(t.roomDetail.listIdUser[0]):"https://bootdey.com/img/Content/avatar/avatar1.png",o.LSH)}}function nt(r,e){1&r&&(o.TgZ(0,"div",37),o._UZ(1,"nz-spin",38),o.qZA()),2&r&&(o.xp6(1),o.Q6J("nzSize","large"))}function ot(r,e){if(1&r&&(o.TgZ(0,"div"),o._UZ(1,"img",44),o.qZA()),2&r){const t=o.oxw(2).$implicit;o.xp6(1),o.s9C("nzSrc",t.image)}}function rt(r,e){if(1&r&&(o.TgZ(0,"div",41)(1,"div"),o._UZ(2,"img",42),o.qZA(),o.TgZ(3,"div",43),o.YNc(4,ot,2,1,"div",9),o._uU(5),o.qZA()()),2&r){const t=o.oxw().$implicit,n=o.oxw(2);o.xp6(2),o.Q6J("src",n.getAvatar(t.userId)?n.getAvatar(t.userId):"https://bootdey.com/img/Content/avatar/avatar1.png",o.LSH),o.xp6(2),o.Q6J("ngIf",t.image),o.xp6(1),o.hij(" ",t.content," ")}}function it(r,e){if(1&r&&(o.TgZ(0,"div"),o._UZ(1,"img",44),o.qZA()),2&r){const t=o.oxw(2).$implicit;o.xp6(1),o.s9C("nzSrc",t.image)}}function st(r,e){if(1&r&&(o.TgZ(0,"div",45)(1,"div"),o._UZ(2,"img",36),o.qZA(),o.TgZ(3,"div",46)(4,"div",47),o._uU(5),o.qZA(),o.TgZ(6,"div",48),o.YNc(7,it,2,1,"div",9),o._uU(8),o.qZA()()()),2&r){const t=o.oxw().$implicit,n=o.oxw(2);o.xp6(1),o.Akn(t.userName?"margin-top: 20px":""),o.xp6(1),o.Q6J("src",n.getAvatar(t.userId)?n.getAvatar(t.userId):"https://bootdey.com/img/Content/avatar/avatar1.png",o.LSH),o.xp6(3),o.Oqu(t.userName),o.xp6(2),o.Q6J("ngIf",t.image),o.xp6(1),o.hij(" ",t.content," ")}}function at(r,e){if(1&r&&(o.TgZ(0,"div"),o.YNc(1,rt,6,3,"div",39),o.YNc(2,st,9,6,"div",40),o.qZA()),2&r){const t=e.$implicit,n=o.oxw(2);o.xp6(1),o.Q6J("ngIf",n.myInfor.userName==t.userName),o.xp6(1),o.Q6J("ngIf",n.myInfor.userName!=t.userName)}}function ct(r,e){1&r&&(o.TgZ(0,"label",49),o._uU(1,"Choose file"),o.qZA())}function lt(r,e){if(1&r&&(o.TgZ(0,"div",50),o._UZ(1,"img",51),o.qZA()),2&r){const t=o.oxw(2);o.xp6(1),o.s9C("src",t.imageURL,o.LSH)}}function ht(r,e){if(1&r){const t=o.EpF();o.TgZ(0,"main",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"div",8),o.YNc(8,et,2,1,"nz-avatar-group",9),o.YNc(9,tt,1,1,"img",10),o.qZA(),o.TgZ(10,"div",11)(11,"strong"),o._uU(12),o.qZA(),o.TgZ(13,"div",12)(14,"em"),o._uU(15),o.ALo(16,"json"),o.qZA()()(),o.TgZ(17,"div")(18,"button",13),o.O4$(),o.TgZ(19,"svg",14),o._UZ(20,"circle",15)(21,"circle",16)(22,"circle",17),o.qZA()()()()(),o.kcU(),o.TgZ(23,"div",18)(24,"div",19,20),o.NdJ("scroll",function(i){o.CHM(t);const s=o.oxw();return o.KtG(s.onScroll(i))}),o.YNc(26,nt,2,1,"div",21),o.YNc(27,at,3,2,"div",22),o.qZA()(),o.TgZ(28,"div",23)(29,"div",24)(30,"form",25),o.NdJ("ngSubmit",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.submitForm())}),o.TgZ(31,"nz-form-item")(32,"nz-form-control",26)(33,"nz-input-group",27),o._UZ(34,"input",28),o.qZA(),o.TgZ(35,"nz-input-group",29)(36,"input",30),o.NdJ("change",function(i){o.CHM(t);const s=o.oxw();return o.KtG(s.OnChangeFile(i))}),o.qZA(),o.YNc(37,ct,2,0,"label",31),o.YNc(38,lt,2,1,"div",32),o.qZA()()(),o.TgZ(39,"nz-form-item")(40,"nz-form-control")(41,"button",33),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.send())}),o._uU(42,"Send"),o.qZA()()()()()()()()()()()}if(2&r){const t=o.oxw();o.xp6(8),o.Q6J("ngIf",t.roomDetail.listIdUser&&t.roomDetail.listIdUser.length>2),o.xp6(1),o.Q6J("ngIf",t.roomDetail.listIdUser&&t.roomDetail.listIdUser.length<=2),o.xp6(3),o.Oqu(t.roomDetail.roomName),o.xp6(3),o.Oqu(o.lcZ(16,10,t.roomDetail.listUser)),o.xp6(11),o.Q6J("ngIf",t.loading),o.xp6(1),o.Q6J("ngForOf",t.data),o.xp6(3),o.Q6J("nzLayout","inline")("formGroup",t.validateForm),o.xp6(7),o.Q6J("ngIf",!t.fileImage),o.xp6(1),o.Q6J("ngIf",t.fileImage)}}let dt=(()=>{class r{constructor(t,n,i,s,l){this.chatService=t,this.fb=n,this.authService=i,this.roomService=s,this.message=l,this.data=[],this.loading=!0,this.throttle=0,this.distance=2,this.page=1,this.loadnew=!0,this.validateForm=this.fb.group({content:[""],image:[null]})}ngOnInit(){this.idRoom&&(this.loadData(),this.loadRoomInfo());const t=(new ae).configureLogging(a.Information).withUrl(q.N.hubUrl).build();t.start().then(function(){console.log("SignalR Connected!")}).catch(function(n){return console.error(n.toString())}),t.on("Message",n=>{n.userNameReceive.includes(this.authService.getUserName())&&n.roomId==this.idRoom&&(console.log("load"),this.page=1,this.loadData())})}ngOnChanges(t){console.log(this.myInfor),this.idRoom&&(this.data=[],this.validateForm.controls.content.setValue(""),this.validateForm.controls.image.setValue(null),this.fileImage=null,this.loading=!0,this.page=1,this.loadData(),this.loadRoomInfo())}loadData(){this.idRoom&&this.chatService.getListChatByIdRoom(this.idRoom).subscribe(t=>{this.data=t.data,this.loading=!1,this.scrollBottom()})}loadRoomInfo(){this.roomService.getRoomInfor(this.idRoom).subscribe(t=>{console.log(t),this.roomDetail=t})}getAvatar(t){try{if(null!=this.usersDetail&&this.usersDetail.filter(n=>n.userid==t))return this.usersDetail.filter(n=>n.id==t)[0].image}catch{return null}}submitForm(){for(const t in this.validateForm.controls)this.validateForm.controls[t].markAsDirty(),this.validateForm.controls[t].updateValueAndValidity()}scrollBottom(){try{this.content.nativeElement.scrollTop=this.content.nativeElement.scrollHeight}catch{console.log("error scroll")}}OnChangeFile(t){this.fileImage=t.target.files[0];const n=new FileReader;n.onload=()=>{this.imageURL=n.result},n.readAsDataURL(this.fileImage)}send(){if(this.idRoom){const t=new FormData;t.append("Image",this.fileImage||null),t.append("RoomId",this.idRoom),t.append("Content",this.validateForm.controls.content.value),this.validateForm.valid&&(""!==this.validateForm.controls.content.value||this.validateForm.controls.image.value?(this.data.push({content:t.get("Content"),userName:this.myInfor.userName,userId:this.myInfor.id,image:this.imageURL||null}),this.validateForm.controls.content.setValue(""),this.fileImage=null,this.imageURL=null,this.chatService.sendMessageImage(t).subscribe(n=>{n.success?(this.validateForm.controls.image.setValue(null),this.scrollBottom()):(this.validateForm.controls.content.setValue(t.get("Content")),this.fileImage=t.get("Image"),this.message.error("\u0110\xe3 x\u1ea3y ra l\u1ed7i, Vui l\xf2ng th\u1eed l\u1ea1i!"))},n=>{this.validateForm.controls.content.setValue(t.get("Content")),this.fileImage=t.get("Image"),this.message.error("Vui l\xf2ng ki\u1ec3m tra k\u1ebft n\u1ed1i!")})):this.message.warning("Vui l\xf2ng nh\u1eadp tin nh\u1eafn!"))}}onScrollUp(t){console.log("scrolled up!",t),this.chatService.getListChatByIdRoom(this.idRoom,++this.page).subscribe(n=>{this.data.push(...n.data)})}onScroll(t){console.log("scroll"),0===this.content.nativeElement.scrollTop&&-1!=this.page&&(this.loading=!0,this.chatService.getListChatByIdRoom(this.idRoom,++this.page).subscribe(n=>{if(0==n.data.length)this.message.info("H\u1ebft"),this.page=-1;else{var i=n.data.concat(this.data);this.data=i,this.content.nativeElement.scrollTop=this.content.nativeElement.scrollTop+4}this.loading=!1}))}loadFinish(t){console.log("d\xe2dada")}}return r.\u0275fac=function(t){return new(t||r)(o.Y36(Ke),o.Y36(y.qu),o.Y36(ce.e),o.Y36(O),o.Y36(he.dD))},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-chat-box"]],viewQuery:function(t,n){if(1&t&&o.Gf(Xe,5),2&t){let i;o.iGM(i=o.CRH())&&(n.content=i.first)}},inputs:{idRoom:"idRoom",usersDetail:"usersDetail",myInfor:"myInfor"},features:[o.TTD],decls:1,vars:1,consts:[["class","content",4,"ngIf"],[1,"content"],[1,"container","p-0"],[1,"card"],[1,"row","g-0"],[1,"col-12","col-lg-7","col-xl-9"],[1,"py-2","px-4","border-bottom","d-lg-block"],[1,"d-flex","align-items-center","py-1"],[1,"position-relative",2,"margin-right","20px"],[4,"ngIf"],["class","rounded-circle mr-1","alt","Sharon Lessman","width","40","height","40",3,"src",4,"ngIf"],[1,"flex-grow-1","pl-3"],[1,"text-muted","small"],[1,"btn","btn-light","border","btn-lg","px-3"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-more-horizontal","feather-lg"],["cx","12","cy","12","r","1"],["cx","19","cy","12","r","1"],["cx","5","cy","12","r","1"],[1,"position-relative"],["id","chat",1,"chat-messages","p-4",2,"height","500px",3,"scroll"],["content1",""],["style","margin: auto;",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"flex-grow-0","py-3","px-4","border-top"],[1,"input-group"],["nz-form","",3,"nzLayout","formGroup","ngSubmit"],["nzErrorTip","Please input your Room",2,"width","100%"],["nzPrefixIcon","user",2,"width","100%"],["formControlName","content","nz-input","","type","text","placeholder","Type your message","width","100%",1,"form-control"],["nzPrefixIcon","user"],["type","file","id","upload","formControlName","image","hidden","",3,"change"],["for","upload",4,"ngIf"],["style","margin-left: 50px; margin-top: 20px;",4,"ngIf"],["nz-button","","nzType","primary",1,"btn","btn-primary",3,"click"],["nzIcon","user","nzTooltipTitle","item",3,"nzSrc",4,"ngFor","ngForOf"],["nzIcon","user","nzTooltipTitle","item",3,"nzSrc"],["alt","Sharon Lessman","width","40","height","40",1,"rounded-circle","mr-1",3,"src"],[2,"margin","auto"],["nzSimple","",3,"nzSize"],["class","chat-message-right pb-4",4,"ngIf"],["class","chat-message-left pb-4",4,"ngIf"],[1,"chat-message-right","pb-4"],["alt","Chris Wood","width","40","height","40",1,"rounded-circle","mr-1",3,"src"],[1,"flex-shrink-1","rounded","py-2","px-3","mr-3",2,"margin-right","10px","max-width","60%","background-color","#00bfff"],["nz-image","","alt","",2,"max-width","100%",3,"nzSrc"],[1,"chat-message-left","pb-4"],[1,"flex-shrink-1",2,"margin-left","10px","max-width","60%"],[1,"text-muted","small",2,"margin-left","10px"],[1,"flex-shrink-1","bg-light","rounded","py-2","px-3","ml-3"],["for","upload"],[2,"margin-left","50px","margin-top","20px"],["alt","",2,"max-width","10%",3,"src"]],template:function(t,n){1&t&&o.YNc(0,ht,43,12,"main",0),2&t&&o.Q6J("ngIf",n.roomDetail)},dependencies:[I.sg,I.O5,y._Y,y.Fj,y.JJ,y.JL,y.sg,y.u,Z.ix,V.w,Q.dQ,T.t3,T.SK,k.Lr,k.Nx,k.Fd,de.Ie,ge.W,P.Dz,P.w5,I.Ts],styles:[".chat-online[_ngcontent-%COMP%]{color:#34ce57}.chat-offline[_ngcontent-%COMP%]{color:#e4606d}.chat-messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:500px;overflow-y:scroll}.chat-message-left[_ngcontent-%COMP%], .chat-message-right[_ngcontent-%COMP%]{display:flex;flex-shrink:0}.chat-message-left[_ngcontent-%COMP%]{margin-right:auto}.chat-message-right[_ngcontent-%COMP%]{flex-direction:row-reverse;margin-left:auto}.py-3[_ngcontent-%COMP%]{padding-top:1rem!important;padding-bottom:1rem!important}.px-4[_ngcontent-%COMP%]{padding-right:1.5rem!important;padding-left:1.5rem!important}.flex-grow-0[_ngcontent-%COMP%]{flex-grow:0!important}.border-top[_ngcontent-%COMP%]{border-top:1px solid #dee2e6!important}label[_ngcontent-%COMP%]{display:inline-block;background-color:indigo;color:#fff;padding:.5rem;font-family:sans-serif;border-radius:.3rem;cursor:pointer;margin-top:1rem}"]}),r})();function gt(r,e){if(1&r&&(o.TgZ(0,"nz-avatar-group"),o._UZ(1,"nz-avatar",17)(2,"nz-avatar",18),o.qZA()),2&r){const t=o.oxw().$implicit,n=o.oxw();o.xp6(1),o.Q6J("nzSrc",n.getAvatar(t.listIdUser[0])?n.getAvatar(t.listIdUser[0]):"https://bootdey.com/img/Content/avatar/avatar5.png"),o.xp6(1),o.Q6J("nzText","+"+(t.listIdUser.length-1))}}function ut(r,e){if(1&r&&o._UZ(0,"img",19),2&r){const t=o.oxw().$implicit,n=o.oxw();o.Q6J("src",n.getAvatar(t.listIdUser[0])?n.getAvatar(t.listIdUser[0]):"https://bootdey.com/img/Content/avatar/avatar5.png",o.LSH)}}function pt(r,e){1&r&&o._UZ(0,"img",20)}function ft(r,e){if(1&r){const t=o.EpF();o.TgZ(0,"a",9),o.NdJ("click",function(){const s=o.CHM(t).$implicit,l=o.oxw();return o.KtG(l.selectRoom(s.id))}),o.TgZ(1,"div",10),o.YNc(2,gt,3,2,"nz-avatar-group",11),o.YNc(3,ut,1,1,"img",12),o.YNc(4,pt,1,0,"img",13),o.TgZ(5,"div",14),o._uU(6),o.TgZ(7,"div",15),o._UZ(8,"span",16),o._uU(9," Online"),o.qZA()()()()}if(2&r){const t=e.$implicit;o.xp6(2),o.Q6J("ngIf",t.listIdUser&&t.listIdUser.length>2),o.xp6(1),o.Q6J("ngIf",t.listIdUser&&t.listIdUser.length<3),o.xp6(1),o.Q6J("ngIf",!t.listIdUser),o.xp6(2),o.hij(" ",t.roomName," ")}}let mt=(()=>{class r{constructor(t){this.roomService=t,this.allUser=[],this.clickRoom=new o.vpe,this.listRoom=[]}ngOnChanges(t){}ngOnInit(){}selectRoom(t){this.clickRoom.emit(t)}getAvatar(t){try{if(null!=this.allUser&&0!=this.allUser.length&&this.allUser.filter(n=>n.userid==t))return this.allUser.filter(n=>n.id==t)[0].image||null}catch{return null}return null}}return r.\u0275fac=function(t){return new(t||r)(o.Y36(O))},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-room-box"]],inputs:{allUser:"allUser",listRoom:"listRoom"},outputs:{clickRoom:"clickRoom"},features:[o.TTD],decls:9,vars:1,consts:[["nz-col","","nzFlex","1"],[2,"margin-left","20px"],[1,"px-4","d-none","d-md-block"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],["type","text","placeholder","Search...",1,"form-control","my-3"],[1,"list"],["style","margin-bottom: 20px;","class","list-group-item list-group-item-action border-0",3,"click",4,"ngFor","ngForOf"],[1,"d-block","d-lg-none","mt-1","mb-0"],[1,"list-group-item","list-group-item-action","border-0",2,"margin-bottom","20px",3,"click"],[1,"d-flex","align-items-start"],[4,"ngIf"],["class","rounded-circle mr-1","alt","Vanessa Tucker","width","40","height","40","style","margin-right: 20px;",3,"src",4,"ngIf"],["src","https://bootdey.com/img/Content/avatar/avatar5.png","class","rounded-circle mr-1","alt","Vanessa Tucker","width","40","height","40","style","margin-right: 20px;",4,"ngIf"],[1,"flex-grow-1","ml-3"],[1,"small"],[1,"fas","fa-circle","chat-online"],["nzIcon","user",3,"nzSrc"],[2,"background-color","#fde3cf","color","#f56a00",3,"nzText"],["alt","Vanessa Tucker","width","40","height","40",1,"rounded-circle","mr-1",2,"margin-right","20px",3,"src"],["src","https://bootdey.com/img/Content/avatar/avatar5.png","alt","Vanessa Tucker","width","40","height","40",1,"rounded-circle","mr-1",2,"margin-right","20px"]],template:function(t,n){1&t&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),o._UZ(5,"input",5),o.qZA()()(),o.TgZ(6,"div",6),o.YNc(7,ft,10,4,"a",7),o.qZA(),o._UZ(8,"hr",8),o.qZA()()),2&t&&(o.xp6(7),o.Q6J("ngForOf",n.listRoom))},dependencies:[I.sg,I.O5,T.t3,P.Dz,P.w5],styles:[".list[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:600px;overflow-y:scroll}"]}),r})();const _t=["local_video"],vt=["received_video"],Ct={audio:!0,video:{width:1280,height:720}},bt={offerToReceiveAudio:!0,offerToReceiveVideo:!0},yt=[{path:"",component:(()=>{class r{constructor(t,n,i,s){this.roomService=t,this.userService=n,this.authService=i,this.notification=s,this.local_video=o.SBq,this.remoteVideo=o.SBq,this.localStream=MediaStream,this.perconection=RTCPeerConnection,this.isVisible=!1,this.allUser=[],this.idRoomSelected=null,this.listRoom=[]}ngAfterViewInit(){this.requestMediaDevice()}ngOnInit(){this.loadRoom(),this.loadAllUser(),this.loadUserInfor();const t=(new ae).configureLogging(a.Information).withUrl(q.N.hubUrl).build();t.start().then(function(){console.log("SignalR Connected!")}).catch(function(n){return console.error(n.toString())}),t.on("Message",n=>{n.userNameReceive.includes(this.authService.getUserName())&&(this.loadRoom(),this.createNotification("1 th\xf4ng b\xe1o t\u1eeb "+n.userNameSend,n.content))})}loadRoom(){this.roomService.getListRooom().subscribe(t=>{this.listRoom=t})}loadAllUser(){this.userService.getListUser().subscribe(t=>{this.allUser=t})}loadUserInfor(){this.userService.getUserInfor().subscribe(t=>{this.myInfor=t})}selectRoom(t){this.idRoomSelected=t}createNotification(t,n){this.notification.create("info",t,n)}requestMediaDevice(){var t=this;return m(function*(){t.localStream=yield navigator.mediaDevices.getUserMedia(Ct),t.pauLocalvideo()})()}StartLocalDevice(){console.log("starting local stream"),this.localStream.getTracks().forEach(t=>{t.enabled=!0}),this.local_video.nativeElement.srcObject=this.localStream}pauLocalvideo(){console.log("pause local stream"),this.localStream.getTracks().forEach(t=>{t.enabled=!1}),this.local_video.nativeElement.srcObject=void 0}call(){var t=this;return m(function*(){t.createConnection(),t.localStream.getTracks().forEach(n=>{t.perconection.addTrack(n,t.localStream)});try{const n=yield t.perconection.createOffer(bt);yield t.perconection.setLocalDescription(n),console.log(n)}catch{}})()}createConnection(){this.perconection=new RTCPeerConnection({iceServers:[{urls:["stun.kundenserver.de:3478"]}]})}}return r.\u0275fac=function(t){return new(t||r)(o.Y36(O),o.Y36(Ve),o.Y36(ce.e),o.Y36(le.zb))},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-home-page"]],viewQuery:function(t,n){if(1&t&&(o.Gf(_t,5),o.Gf(vt,5)),2&t){let i;o.iGM(i=o.CRH())&&(n.local_video=i.first),o.iGM(i=o.CRH())&&(n.remoteVideo=i.first)}},decls:17,vars:9,consts:[[3,"list","taoThanhCong"],["nz-row",""],["nz-col","","nzFlex","1"],[3,"allUser","listRoom","clickRoom"],["nz-col","","nzFlex","6"],[3,"idRoom","usersDetail","myInfor"],[3,"autoplay","muted"],["local_video",""],["nz-button","","nzType","primary",3,"click"],["nz-button","","nzType","primary","nzDanger","",3,"click"],[3,"autoplay"],["received_video",""]],template:function(t,n){1&t&&(o.TgZ(0,"app-create-room",0),o.NdJ("taoThanhCong",function(){return n.loadRoom()}),o.qZA(),o.TgZ(1,"div",1)(2,"div",2)(3,"app-room-box",3),o.NdJ("clickRoom",function(s){return n.selectRoom(s)}),o.qZA()(),o.TgZ(4,"div",4),o._UZ(5,"app-chat-box",5),o.qZA()(),o.TgZ(6,"div",1)(7,"div",4),o._UZ(8,"video",6,7),o.TgZ(10,"button",8),o.NdJ("click",function(){return n.StartLocalDevice()}),o._uU(11,"START"),o.qZA(),o.TgZ(12,"button",9),o.NdJ("click",function(){return n.pauLocalvideo()}),o._uU(13,"STOP"),o.qZA()(),o.TgZ(14,"div",4),o._UZ(15,"video",10,11),o.qZA()()),2&t&&(o.Q6J("list",n.allUser),o.xp6(3),o.Q6J("allUser",n.allUser)("listRoom",n.listRoom),o.xp6(2),o.Q6J("idRoom",n.idRoomSelected)("usersDetail",n.allUser)("myInfor",n.myInfor),o.xp6(3),o.Q6J("autoplay",!0)("muted",!0),o.xp6(7),o.Q6J("autoplay",!0))},dependencies:[Z.ix,V.w,Q.dQ,T.t3,T.SK,Ge,dt,mt],styles:["body[_ngcontent-%COMP%]{margin-top:20px}.chat-online[_ngcontent-%COMP%]{color:#34ce57}.chat-offline[_ngcontent-%COMP%]{color:#e4606d}.chat-messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:800px;overflow-y:scroll}.chat-message-left[_ngcontent-%COMP%], .chat-message-right[_ngcontent-%COMP%]{display:flex;flex-shrink:0}.chat-message-left[_ngcontent-%COMP%]{margin-right:auto}.chat-message-right[_ngcontent-%COMP%]{flex-direction:row-reverse;margin-left:auto}.py-3[_ngcontent-%COMP%]{padding-top:1rem!important;padding-bottom:1rem!important}.px-4[_ngcontent-%COMP%]{padding-right:1.5rem!important;padding-left:1.5rem!important}.flex-grow-0[_ngcontent-%COMP%]{flex-grow:0!important}.border-top[_ngcontent-%COMP%]{border-top:1px solid #dee2e6!important}"]}),r})()}];let wt=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=o.oAB({type:r}),r.\u0275inj=o.cJS({imports:[K.Bz.forChild(yt),K.Bz]}),r})();var St=p(8897),xt=p(1218),Tt=p(1148),It=p(7442),kt=p(9712);let Et=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=o.oAB({type:r}),r.\u0275inj=o.cJS({imports:[I.ez,y.UX,wt,Z.sL,T.Jb,St.vh,xt.PV,F.Qp,k.U5,Tt.Ph,F.Qp,Y.LV,It.X,he.gR,de.Gb,y.u5,ge.j,kt.X,P.Rt,le.L8]}),r})()}}]);